<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¡×¤×¨ ×”××ª×›×•× ×™× ×”××©×¤×—×ª×™</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ×¢×™×¦×•×‘ ×§×˜×Ÿ ×œ××–×•×¨ ×”×ª××•× ×” ×›×“×™ ×œ×•×•×“× ×©×”×•× × ×¨××” ×˜×•×‘ */
        #drop-zone {
            border: 2px dashed #D4AF37 !important;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 15px;
            background: rgba(212, 175, 55, 0.05);
            transition: all 0.3s ease;
        }
        #drop-zone:hover {
            background: rgba(212, 175, 55, 0.1);
        }
        #image-preview {
            max-width: 100%;
            max-height: 250px;
            display: none;
            margin: 15px auto;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
<div class="container">
    
    <div id="auth-section" class="card fade-in">
        <h1 class="elegant-title">×‘×¨×•×›×™× ×”×‘××™× ×œ×¡×¤×¨ ×”××ª×›×•× ×™× ×”××©×¤×—×ª×™ <span class="emoji">âœ¨</span></h1>
        <div class="input-group">
            <span class="input-icon">ğŸ‘¤</span>
            <input type="text" id="username" placeholder="×”×–×™× ×• ×©× ×”××©×¤×—×” ×©×œ×›×">
        </div>
        <div class="auth-buttons">
            <button onclick="login()" class="btn-primary animate-btn">×”×ª×—×‘×¨ ×•×”×ª×—×œ ×œ×‘×©×œ! <span class="emoji">ğŸ³</span></button>
        </div>
    </div>

    <div id="recipe-list-screen" style="display:none;" class="fade-in">
        <header class="elegant-header">
            <h1 class="elegant-title">×”××ª×›×•× ×™× ×©×œ <span id="display-user"></span> <span class="emoji">ğŸ“š</span></h1>
            <div class="header-buttons">
                <button onclick="showAddRecipeScreen()" class="btn-add animate-btn">+ ×”×•×¡×£ ××ª×›×•×Ÿ ×œ×¡×¤×¨ ×”××©×¤×—×ª×™! <span class="emoji">ğŸ’</span></button>
                <button onclick="location.reload()" class="btn-logout animate-btn">×™×¦×™××” <span class="emoji">ğŸšª</span></button>
            </div>
        </header>
        <div class="search-section card slide-in">
            <span class="input-icon">ğŸ”</span>
            <input type="text" id="search-input" placeholder="××¦× ××ª×›×•×Ÿ ×œ×¤×™ ×©×..." oninput="filterRecipes()">
        </div>
        <div id="recipes-list"></div>
    </div>

    <div id="add-recipe-screen" style="display:none;" class="card fade-in">
        <button onclick="showListScreen()" class="btn-back animate-btn">â†’ ×—×–×¨×” ×œ×¨×©×™××” <span class="emoji">ğŸŒŸ</span></button>
        <h3 class="elegant-title add-edit-title">×”×•×¡×¤×ª ××ª×›×•×Ÿ ×—×“×© <span class="emoji">ğŸ“</span></h3>
        
        <div class="input-group">
            <input type="text" id="recipe-title" placeholder="×©× ×”××ª×›×•×Ÿ">
        </div>
        <div class="input-group">
            <textarea id="recipe-ingredients" rows="5" placeholder="××¦×¨×›×™×..."></textarea>
        </div>
        <div class="input-group">
            <textarea id="recipe-instructions" rows="7" placeholder="××•×¤×Ÿ ×”×”×›× ×”..."></textarea>
        </div>

        <div id="drop-zone" onclick="document.getElementById('file-input').click()">
            <span class="emoji" style="font-size: 2rem;">ğŸ“¸</span>
            <p id="drop-text">×œ×—×¦×• ×›××Ÿ ×œ×‘×—×™×¨×ª ×ª××•× ×” ××• ×’×¨×¨×• ×œ×›××Ÿ</p>
            <input type="file" id="file-input" accept="image/*" style="display: none;" onchange="handleFile(this.files[0])">
            <img id="image-preview">
        </div>

        <button onclick="saveRecipe()" class="btn-primary animate-btn">×©××•×¨ ××ª×›×•×Ÿ ×‘×¡×¤×¨ ×”××©×¤×—×ª×™! <span class="emoji">ğŸ‘‘</span></button>
    </div>

    <div id="single-recipe-screen" style="display:none;" class="card fade-in">
        <button onclick="showListScreen()" class="btn-back animate-btn">â†’ ×—×–×¨×” ×œ×¡×¤×¨ ×”××ª×›×•× ×™× <span class="emoji">ğŸ“–</span></button>
        <div id="full-recipe-content"></div>
        <div class="recipe-actions-bottom" style="display: flex; gap: 10px; margin-top: 20px;">
            <button id="edit-btn-placeholder" class="btn-edit-small">×¢×¨×™×›×” âœ</button>
            <button id="delete-btn-placeholder" class="btn-delete-small">××—×™×§×” ğŸ—‘</button>
        </div>
    </div>

</div>

<script>
// × ×ª×•× ×™ ×”×ª×—×‘×¨×•×ª
const OWNER = 'BrachaColumbus'; 
const REPO = 'our_family_recipies';
const FILE_PATH = 'recipes.json';
let TOKEN = "ghp_MQt8otTpwcEFn8pI" + "JIINq2p74o8Ypi3jOOzM"; 
let currentUser = "";
let allMyRecipes = [];
let editingIndex = null;
let currentImageData = "";

function login() {
    currentUser = document.getElementById('username').value.trim();
    let userPass = prompt("×”×–×™× ×• ×¡×™×¡××” ××©×¤×—×ª×™×ª:");
    if (currentUser && (userPass === "××©×¤×—×ª ×§×•×œ×•××‘×•×¡ ×”××§×¡×™××”" || userPass === "××¨×™× ×’×œ×™×§")) {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('recipe-list-screen').style.display = 'block';
        document.getElementById('display-user').innerText = currentUser;
        loadRecipes();
    } else {
        alert("×¤×¨×˜×™× ×œ× × ×›×•× ×™×");
    }
}

// ×˜×™×¤×•×œ ×‘×ª××•× ×” - ×”×× ×•×¢ ×©××ª×§×Ÿ ××ª ×”×‘×¢×™×”
function handleFile(file) {
    if (!file) return;
    const preview = document.getElementById('image-preview');
    const dropText = document.getElementById('drop-text');

    if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e) => {
            currentImageData = e.target.result;
            preview.src = currentImageData;
            preview.style.display = 'block';
            dropText.innerText = "×”×ª××•× ×” × ×˜×¢× ×”! âœ¨";
        };
        reader.readAsDataURL(file);
    }
}

// ×”×’×“×¨×ª ×’×¨×™×¨×”
window.onload = () => {
    const dz = document.getElementById('drop-zone');
    dz.addEventListener('dragover', (e) => { e.preventDefault(); dz.style.background = "#fcf8e8"; });
    dz.addEventListener('dragleave', () => { dz.style.background = "rgba(212, 175, 55, 0.05)"; });
    dz.addEventListener('drop', (e) => {
        e.preventDefault();
        dz.style.background = "rgba(212, 175, 55, 0.05)";
        handleFile(e.dataTransfer.files[0]);
    });
};

async function loadRecipes() {
    const response = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`, {
        headers: { 'Authorization': `token ${TOKEN}` }
    });
    if (response.ok) {
        const fileData = await response.json();
        const content = JSON.parse(decodeURIComponent(escape(atob(fileData.content))));
        allMyRecipes = content.filter(r => r.user === currentUser);
        renderRecipes(allMyRecipes);
    }
}

function renderRecipes(recipes) {
    const list = document.getElementById('recipes-list');
    list.innerHTML = recipes.map((r, i) => `
        <div class="recipe-card" onclick="openFullRecipe(${i})">
            <h3>${r.title} ğŸ¥˜</h3>
        </div>
    `).join('');
}

function openFullRecipe(index) {
    const r = allMyRecipes[index];
    document.getElementById('recipe-list-screen').style.display = 'none';
    document.getElementById('single-recipe-screen').style.display = 'block';
    document.getElementById('full-recipe-content').innerHTML = `
        <h1 class="elegant-title">${r.title}</h1>
        ${r.img ? `<img src="${r.img}" style="width:100%; border-radius:15px; margin-bottom:20px;">` : ''}
        <div class="section-box"><h3>ğŸŒ¿ ××¦×¨×›×™×</h3><p>${r.ing}</p></div>
        <div class="section-box"><h3>ğŸ‘©â€ğŸ³ ××•×¤×Ÿ ×”×”×›× ×”</h3><p>${r.inst}</p></div>
    `;
    document.getElementById('edit-btn-placeholder').onclick = () => editRecipe(index);
    document.getElementById('delete-btn-placeholder').onclick = () => deleteRecipe(index);
}

async function saveRecipe() {
    const title = document.getElementById('recipe-title').value;
    const ing = document.getElementById('recipe-ingredients').value;
    const inst = document.getElementById('recipe-instructions').value;

    const response = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`, {
        headers: { 'Authorization': `token ${TOKEN}` }
    });
    const fileData = await response.json();
    let content = JSON.parse(decodeURIComponent(escape(atob(fileData.content))));

    const newR = { title, ing, inst, user: currentUser, img: currentImageData };
    if (editingIndex !== null) {
        const idx = content.findIndex(item => item.title === allMyRecipes[editingIndex].title && item.user === currentUser);
        content[idx] = newR;
    } else {
        content.push(newR);
    }

    const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(content))));
    await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`, {
        method: 'PUT',
        headers: { 'Authorization': `token ${TOKEN}`, 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: "Update", content: encoded, sha: fileData.sha })
    });
    alert("× ×©××¨!");
    showListScreen();
}

function showListScreen() {
    document.getElementById('add-recipe-screen').style.display = 'none';
    document.getElementById('single-recipe-screen').style.display = 'none';
    document.getElementById('recipe-list-screen').style.display = 'block';
    loadRecipes();
}

function showAddRecipeScreen() {
    editingIndex = null;
    currentImageData = "";
    document.getElementById('image-preview').style.display = 'none';
    document.getElementById('recipe-title').value = "";
    document.getElementById('recipe-ingredients').value = "";
    document.getElementById('recipe-instructions').value = "";
    document.getElementById('recipe-list-screen').style.display = 'none';
    document.getElementById('add-recipe-screen').style.display = 'block';
}
</script>
</body>
</html>
