<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¡×¤×¨ ×”××ª×›×•× ×™× ×”××©×¤×—×ª×™</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ×¢×™×¦×•×‘ ×œ××–×•×¨ ×”×¢×œ××ª ×ª××•× ×” - ×”×¤×¢× ×¢× ×× ×’× ×•×Ÿ ×—×¡×™×Ÿ */
        .upload-container {
            position: relative;
            border: 2px dashed #D4AF37;
            padding: 30px;
            text-align: center;
            border-radius: 15px;
            background: #fffcf0;
            cursor: pointer;
            margin: 20px 0;
            overflow: hidden;
        }
        .upload-container:hover { background: #f7f0d5; }
        
        /* ×”-input ×”×–×” ×™×•×©×‘ ×©×§×•×£ ××¢×œ ×›×œ ×”××–×•×¨ - ×›×š ×©×›×œ ×œ×—×™×¦×” ×ª×¤×¢×™×œ ××•×ª×• */
        #file-input {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        #image-preview {
            max-width: 100%;
            max-height: 200px;
            display: none;
            margin-top: 15px;
            border-radius: 10px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="auth-section" class="card fade-in">
        <h1 class="elegant-title">×¡×¤×¨ ×”××ª×›×•× ×™× ×©×œ ×§×•×œ×•××‘×•×¡ ğŸ¥˜</h1>
        <input type="text" id="username" placeholder="×©× ××©×ª××©" style="width:100%; padding:10px; margin-bottom:10px;">
        <button onclick="login()" class="btn-primary" style="width:100%;">×›× ×™×¡×” âœ¨</button>
    </div>

    <div id="recipe-list-screen" style="display:none;">
        <button onclick="showAddRecipeScreen()" class="btn-add">+ ×”×•×¡×£ ××ª×›×•×Ÿ ×—×“×©</button>
        <div id="recipes-list"></div>
    </div>

    <div id="add-recipe-screen" style="display:none;" class="card">
        <button onclick="showListScreen()" class="btn-back">â† ×—×–×•×¨</button>
        <h2 id="form-title">××ª×›×•×Ÿ ×—×“×©</h2>
        
        <input type="text" id="recipe-title" placeholder="×©× ×”×× ×”" style="width:100%; margin:10px 0; padding:10px;">
        <textarea id="recipe-ingredients" placeholder="××¦×¨×›×™×" rows="4" style="width:100%; margin:10px 0;"></textarea>
        <textarea id="recipe-instructions" placeholder="××•×¤×Ÿ ×”×›× ×”" rows="6" style="width:100%; margin:10px 0;"></textarea>

        <div class="upload-container" id="drop-zone">
            <span style="font-size: 40px;">ğŸ“¸</span>
            <p id="drop-text">×œ×—×¦×• ×›××Ÿ ×œ×”×¢×œ××ª ×ª××•× ×”</p>
            <input type="file" id="file-input" accept="image/*">
            <img id="image-preview">
        </div>

        <button onclick="saveRecipe()" class="btn-primary" style="width:100%;">×©××•×¨ ××ª×›×•×Ÿ ×‘×¡×¤×¨ ğŸ‘‘</button>
    </div>

    <div id="single-recipe-screen" style="display:none;">
        <button onclick="showListScreen()" class="btn-back">â† ×—×–×¨×” ×œ×¨×©×™××”</button>
        <div id="full-recipe-content"></div>
    </div>
</div>

<script>
const OWNER = 'BrachaColumbus';
const REPO = 'our_family_recipies';
const FILE_PATH = 'recipes.json';
const TOKEN = "ghp_MQt8otTpwcEFn8pI" + "JIINq2p74o8Ypi3jOOzM";

let currentUser = "";
let allMyRecipes = [];
let currentImageData = "";
let editingIndex = null;

// ×¤×•× ×§×¦×™×™×ª ×”×ª×—×‘×¨×•×ª ×¤×©×•×˜×”
function login() {
    currentUser = document.getElementById('username').value.trim();
    if (currentUser) {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('recipe-list-screen').style.display = 'block';
        loadRecipes();
    }
}

// ×”×× ×’× ×•×Ÿ ×œ×˜×™×¤×•×œ ×‘×ª××•× ×” - ××•×¤×¢×œ ××•×˜×•××˜×™×ª ×‘×©×™× ×•×™ ×©×œ ×”-input
document.addEventListener('change', function(e) {
    if (e.target && e.target.id === 'file-input') {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                currentImageData = event.target.result;
                const preview = document.getElementById('image-preview');
                preview.src = currentImageData;
                preview.style.display = 'block';
                document.getElementById('drop-text').innerText = "×ª××•× ×” × ×‘×—×¨×”! âœ…";
            };
            reader.readAsDataURL(file);
        }
    }
});

async function loadRecipes() {
    try {
        const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`, {
            headers: { 'Authorization': `token ${TOKEN}` }
        });
        const data = await res.json();
        const content = JSON.parse(decodeURIComponent(escape(atob(data.content))));
        allMyRecipes = content.filter(r => r.user === currentUser);
        
        const list = document.getElementById('recipes-list');
        list.innerHTML = allMyRecipes.map((r, i) => `
            <div class="recipe-card" style="padding:15px; border:1px solid #ddd; margin:10px 0; border-radius:10px; background:white; cursor:pointer;" onclick="openRecipe(${i})">
                <h3>${r.title}</h3>
            </div>
        `).join('');
    } catch (err) { console.error("×˜×¢×™× ×” × ×›×©×œ×”"); }
}

function openRecipe(index) {
    const r = allMyRecipes[index];
    document.getElementById('recipe-list-screen').style.display = 'none';
    document.getElementById('single-recipe-screen').style.display = 'block';
    document.getElementById('full-recipe-content').innerHTML = `
        <h1 class="elegant-title">${r.title}</h1>
        ${r.img ? `<img src="${r.img}" style="width:100%; border-radius:15px; margin-bottom:20px;">` : ''}
        <div class="section-box"><h3>ğŸŒ¿ ××¦×¨×›×™×</h3><p>${r.ing}</p></div>
        <div class="section-box"><h3>ğŸ‘©â€ğŸ³ ××•×¤×Ÿ ×”×”×›× ×”</h3><p>${r.inst}</p></div>
    `;
}

async function saveRecipe() {
    const title = document.getElementById('recipe-title').value;
    const ing = document.getElementById('recipe-ingredients').value;
    const inst = document.getElementById('recipe-instructions').value;

    if(!title) return alert("×¦×¨×™×š ×›×•×ª×¨×ª!");

    try {
        const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`, {
            headers: { 'Authorization': `token ${TOKEN}` }
        });
        const fileData = await res.json();
        let content = JSON.parse(decodeURIComponent(escape(atob(fileData.content))));

        const newR = { title, ing, inst, user: currentUser, img: currentImageData };
        content.push(newR);

        const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(content))));
        await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`, {
            method: 'PUT',
            headers: { 'Authorization': `token ${TOKEN}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: "Add recipe", content: encoded, sha: fileData.sha })
        });
        alert("×”××ª×›×•×Ÿ × ×©××¨ ×‘×”×¦×œ×—×”! âœ¨");
        showListScreen();
    } catch (e) { alert("×©×’×™××” ×‘×©××™×¨×”"); }
}

function showListScreen() {
    document.getElementById('add-recipe-screen').style.display = 'none';
    document.getElementById('single-recipe-screen').style.display = 'none';
    document.getElementById('recipe-list-screen').style.display = 'block';
    loadRecipes();
}

function showAddRecipeScreen() {
    currentImageData = "";
    document.getElementById('image-preview').style.display = 'none';
    document.getElementById('drop-text').innerText = "×œ×—×¦×• ×›××Ÿ ×œ×”×¢×œ××ª ×ª××•× ×”";
    document.getElementById('recipe-list-screen').style.display = 'none';
    document.getElementById('add-recipe-screen').style.display = 'block';
}
</script>
</body>
</html>
